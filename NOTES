NOTES (new install)
===============


* Complete egg-info compilation
** TODO What should the default optimization options be?
    - also for compiled import libraries.
    - respect DEBUGBUILD?
** TODO Do validation of egg-info at some stage
** TODO Ensure destination directories exist
** TODO Install commands must respect DESTDIR.

* Implement minimal "chicken-install"
** TODO rename new-install.scm later
    - rules.make
** Basic functionality
*** TODO just download eggs (recursively) and build/install.
*** TODO Repository init (cross-aware)
*** TODO Update DB
*** TODO print repository
*** TODO retrieve egg
    - also support recursive retrieve?

* TODO repository-path
    - allow multiple locations?
    - might be needed anyway, unless components are to be usable only when installed.
    - CHICKEN_REPOSITORY
    - perhaps: CHICKEN_INSTALL_REPOSITORY (defaults to install-prefix) as
      installation target.

* Issues
** Link-options are passed directly to csc
    - is this right?

* Setup features
** TODO Keep binaries + intermediate files.   
** TODO drop "keep-going" mode.
** TODO "-feature" + "-no-feature"
** TODO Hack for OSX SIP?
** TODO drop csi's -setup-mode
** TODO reinstall, no-install?

* csi
** TODO Drop -setup-mode

* TODO "build-dependencies" 
    - toplevel deps that are needed during build, override "dependencies", if given.
    - or is the intent differently? Ask moritz.

* Download/build directories
** TODO download into cache dir (".chicken-install.download")
    - in HOME, or PWD?
    - when does it become stale?
** TODO build in temp dir (".chicken-install.build")
    - remove if not "-k" and all goes well.
        - use different name (or ".") in case of "-k"?
    - print directories on failure?
** TODO special mode if installing directory from source dir

* TODO Add/remove files
    - update distribution/manifest
    - add: egg-download.scm egg-compile.scm egg-environment.scm
    - rm: setup-api.scm setup-download.scm

* TODO Extract download stuff
** TODO Drop extension listing
** TODO Simplify "local" transport
    - no tag or trunk directories.

* TODO Check what cmdline options to retain
** TODO Option for explicitly generating Windows/UNIX build/install scripts
    - i.e. selecting target platform.

* Things to resolve
** setup-info files
*** one for the whole egg (use "components" to find associated parts).
*** TODO Fix "extension-information"
*** TODO syntax-only extensions
** TODO setup.defaults
** TODO Retrieval from local directory
** TODO Cross-build + cross-chickens
    - needs to compile egg info twice (host- + target-mode).

* TODO Drop CHICKEN_PREFIX

* Drop
** TODO svn transport
** TODO deployment

* TODO Remove setup-api/setup-download from repo

* Build/install scripts
** TODO fully sh(1) compatible
    - http://people.fas.harvard.edu/~lib113/reference/unix/portable_scripting.html
    - https://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/cmd.mspx?mfr=true
** TODO "chicken-do" tool to build if dependencies are newer than target
    - "usage: chicken-do TARGET CMD ... : DEPENDENCIES ..."
    - try to avoid quoting hell, especially on Windows.
    - ideally, use execvp/CreateProcess
        - http://www.cplusplus.com/forum/windows/3398/ and
          http://www.cplusplus.com/forum/beginner/1988/3/#msg14102
** TODO Consider making this powerful enough to build chicken
    - needs support for object-files (C or Scheme) and building libraries.
** TODO Handle case where program and extension in egg have same name
    - e.g. "hyde" in hyde egg.
    - can we ignore this? if source files have different names, just compiling exe/so directly should
      work.

* Install scripts
** TODO Allow overrriding DESTDIR, PREFIX
** TODO Install setup-info
** TODO Use install(1) ?

* Tools
** TODO chicken-install
** TODO chicken-uninstall
** TODO chicken-status

* TODO Copyright headers

* TODO Documentation
    - remove old and obsolete stuff (deployment, dropped options, etc.)
    - update manual
    - chicken-do
    - update egg-tutorial on wiki
